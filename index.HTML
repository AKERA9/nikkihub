<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Primemart - Grocery Shopping</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .tab-active { color: #2563eb; }
        .tab-active span { color: #2563eb; }
        .page-content { display: none; }
        .page-content.active { display: block; }
        .badge-pop { animation: pop 0.3s ease-out; }
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.4); }
            100% { transform: scale(1); }
        }
        .main-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        main {
            flex-grow: 1;
            overflow-y: auto;
            padding-bottom: 80px; /* Space for bottom nav */
        }
        .profile-header {
            background-color: #FEA7A7;
            border-bottom-left-radius: 50% 20%;
            border-bottom-right-radius: 50% 20%;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            #invoice-page, #invoice-page * {
                visibility: visible;
            }
            #invoice-page {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-white">

    <div class="max-w-sm mx-auto bg-white shadow-lg rounded-lg overflow-hidden main-container">

        <header id="main-header" class="p-4 bg-white border-b border-gray-200 z-20 no-print">
            <div class="flex justify-between items-center mb-3">
                <h1 class="text-2xl font-bold text-blue-600">primemart</h1>
                <div class="flex items-center space-x-2">
                    <i class="fa-solid fa-signal text-gray-700"></i>
                    <i class="fa-solid fa-wifi text-gray-700"></i>
                    <i class="fa-solid fa-battery-full text-gray-700"></i>
                </div>
            </div>
            <div class="flex items-center text-sm text-gray-600 mb-4">
                <i class="fa-solid fa-location-dot mr-2 text-gray-500"></i>
                <span>Downtown Dubai</span>
                <i class="fa-solid fa-chevron-down ml-1 text-xs"></i>
            </div>
            <div class="relative">
                <input type="text" placeholder="What are you looking for?" class="w-full bg-gray-100 border border-gray-200 rounded-lg py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
            </div>
             <div class="flex items-center justify-between mt-3 text-xs text-gray-500">
                <div class="flex items-center">
                    <i class="fa-solid fa-truck mr-2"></i>
                    <span>Earliest Delivery</span>
                </div>
                <div class="bg-gray-100 p-1 rounded-md">
                    <span class="bg-white text-blue-600 font-semibold px-2 py-1 rounded">5pm-9pm</span>
                </div>
            </div>
        </header>

        <main class="no-scrollbar">
            <!-- All pages are managed here -->
            <div id="home" class="page-content active p-4"></div>
            <div id="categories" class="page-content p-4"></div>
            <div id="my-item" class="page-content p-4"><h2 class="text-2xl font-bold text-center mt-10">My Items Page</h2><p class="text-center text-gray-500">Yahan aapke items dikhenge.</p></div>
            <div id="cart" class="page-content p-4"></div>
            <div id="profile" class="page-content"></div>
            <div id="all-products-page" class="page-content p-4"></div>
            <div id="category-page" class="page-content p-4"></div>
            <div id="offer-page" class="page-content p-4"></div>
            <div id="checkout-page" class="page-content p-4"></div>
            <div id="confirmation-page" class="page-content p-4"></div>
            <div id="orders-page" class="page-content p-4"></div>
            <div id="invoice-page" class="page-content p-4"></div>
            <!-- Login Flow Pages -->
            <div id="login-mobile-page" class="page-content p-4"></div>
            <div id="login-otp-page" class="page-content p-4"></div>
            <div id="login-details-page" class="page-content p-4"></div>
        </main>

        <nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 max-w-sm mx-auto bg-white border-t border-gray-200 flex justify-around z-30 no-print">
            <button onclick="showTab('home')" class="tab-button tab-active flex flex-col items-center justify-center text-center text-gray-500 p-3 w-full"><i class="fa-solid fa-house text-xl"></i><span class="text-xs font-medium mt-1">Home</span></button>
            <button onclick="showTab('categories')" class="tab-button flex flex-col items-center justify-center text-center text-gray-500 p-3 w-full"><i class="fa-solid fa-layer-group text-xl"></i><span class="text-xs font-medium mt-1">Categories</span></button>
            <button onclick="showTab('my-item')" class="tab-button flex flex-col items-center justify-center text-center text-gray-500 p-3 w-full"><i class="fa-solid fa-box text-xl"></i><span class="text-xs font-medium mt-1">My Item</span></button>
            <button onclick="showTab('cart')" class="tab-button relative flex flex-col items-center justify-center text-center text-gray-500 p-3 w-full"><i class="fa-solid fa-cart-shopping text-xl"></i><span class="text-xs font-medium mt-1">Cart</span><span id="cart-badge" class="absolute top-1 right-5 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center hidden">0</span></button>
            <button onclick="showTab('profile')" class="tab-button flex flex-col items-center justify-center text-center text-gray-500 p-3 w-full"><i class="fa-solid fa-user text-xl"></i><span class="text-xs font-medium mt-1">Profile</span></button>
        </nav>
    </div>

    <script>
        // --- STATE MANAGEMENT ---
        let isLoggedIn = false;
        let currentUser = null;
        let cart = [];
        let deliveryAddress = {};
        let tempMobile = '';
        let checkoutRedirect = false;

        // --- DOM ELEMENTS ---
        const mainHeader = document.getElementById('main-header');
        const bottomNav = document.getElementById('bottom-nav');
        const cartBadge = document.getElementById('cart-badge');
        
        // Page Containers
        const pageContainers = {
            home: document.getElementById('home'),
            categories: document.getElementById('categories'),
            cart: document.getElementById('cart'),
            profile: document.getElementById('profile'),
            allProducts: document.getElementById('all-products-page'),
            category: document.getElementById('category-page'),
            offer: document.getElementById('offer-page'),
            checkout: document.getElementById('checkout-page'),
            confirmation: document.getElementById('confirmation-page'),
            orders: document.getElementById('orders-page'),
            invoice: document.getElementById('invoice-page'),
            loginMobile: document.getElementById('login-mobile-page'),
            loginOtp: document.getElementById('login-otp-page'),
            loginDetails: document.getElementById('login-details-page'),
        };

        // --- DATA ---
        const categoriesData = [
            { name: 'Grocery', image: 'https://placehold.co/64x64/E0F2FE/3B82F6?text=Grocery', bgColor: 'bg-blue-100' },
            { name: 'Fruits', image: 'https://placehold.co/64x64/FEE2E2/EF4444?text=Fruits', bgColor: 'bg-red-100' },
            { name: 'Vegetables', image: 'https://placehold.co/64x64/D1FAE5/10B981?text=Veggies', bgColor: 'bg-green-100' },
            { name: 'Drinks', image: 'https://placehold.co/64x64/EDE9FE/8B5CF6?text=Drinks', bgColor: 'bg-purple-100' },
            { name: 'Dairy & Eggs', image: 'https://placehold.co/64x64/FFEDD5/F97316?text=Dairy', bgColor: 'bg-orange-100' },
            { name: 'Beauty', image: 'https://placehold.co/64x64/FCE7F3/EC4899?text=Beauty', bgColor: 'bg-pink-100' },
            { name: 'Bakery', image: 'https://placehold.co/64x64/FEF3C7/F59E0B?text=Bakery', bgColor: 'bg-yellow-100' },
            { name: 'Meat', image: 'https://placehold.co/64x64/FECACA/DC2626?text=Meat', bgColor: 'bg-red-200' },
        ];
        const seasonalOffersData = [
            { name: 'Holi Offer', image: 'https://placehold.co/300x150/FEF2F2/DC2626?text=Holi+Offer' },
            { name: 'Diwali Offer', image: 'https://placehold.co/300x150/FFF7ED/FB923C?text=Diwali+Offer' },
        ];
        const allProductsData = [
            { id: 1, name: 'Apple', price: 150, originalPrice: 180, image: 'https://placehold.co/150x150/FEF2F2/DC2626?text=Apple', category: 'Fruits', weight: '500 gm', offerTag: 'Diwali' },
            { id: 2, name: 'Orange', price: 80, originalPrice: 100, image: 'https://placehold.co/150x150/FFF7ED/FB923C?text=Orange', category: 'Fruits', weight: '500 gm' },
            { id: 3, name: 'Milk', price: 55, originalPrice: 60, image: 'https://placehold.co/150x150/EFF6FF/60A5FA?text=Milk', category: 'Dairy & Eggs', weight: '1 Ltr', offerTag: 'Holi' },
            { id: 4, name: 'Bread', price: 40, originalPrice: 45, image: 'https://placehold.co/150x150/F3E8FF/C084FC?text=Bread', category: 'Bakery', weight: '400 gm' },
            { id: 5, name: 'Eggs', price: 70, originalPrice: 85, image: 'https://placehold.co/150x150/ECFDF5/34D399?text=Eggs', category: 'Dairy & Eggs', weight: '12 pcs' },
            { id: 6, name: 'Banana', price: 50, originalPrice: 65, image: 'https://placehold.co/150x150/FEF3C7/FBBF24?text=Banana', category: 'Fruits', weight: '1 dozen' },
            { id: 7, name: 'Chicken', price: 250, originalPrice: 280, image: 'https://placehold.co/150x150/DBEAFE/93C5FD?text=Chicken', category: 'Meat', weight: '1 kg' },
            { id: 8, name: 'Tomato', price: 30, originalPrice: 40, image: 'https://placehold.co/150x150/FEE2E2/FCA5A5?text=Tomato', category: 'Vegetables', weight: '500 gm', offerTag: 'Holi' },
            { id: 9, name: 'Potato', price: 25, originalPrice: 35, image: 'https://placehold.co/150x150/E0E7FF/A5B4FC?text=Potato', category: 'Vegetables', weight: '1 kg' },
            { id: 10, name: 'Onion', price: 45, originalPrice: 55, image: 'https://placehold.co/150x150/F5D0FE/E879F9?text=Onion', category: 'Vegetables', weight: '1 kg' },
            { id: 11, name: 'Yogurt', price: 60, originalPrice: 70, image: 'https://placehold.co/150x150/D1FAE5/6EE7B7?text=Yogurt', category: 'Dairy & Eggs', weight: '400 gm', offerTag: 'Holi' },
            { id: 12, name: 'Cheese', price: 120, originalPrice: 135, image: 'https://placehold.co/150x150/FEF9C3/FDE047?text=Cheese', category: 'Dairy & Eggs', weight: '200 gm', offerTag: 'Diwali' },
            { id: 13, name: 'Butter', price: 50, originalPrice: 55, image: 'https://placehold.co/150x150/FEF3C7/F59E0B?text=Butter', category: 'Dairy & Eggs', weight: '100 gm' },
            { id: 14, name: 'Carrot', price: 40, originalPrice: 50, image: 'https://placehold.co/150x150/FFEDD5/FB923C?text=Carrot', category: 'Vegetables', weight: '500 gm' },
            { id: 15, name: 'Broccoli', price: 90, originalPrice: 110, image: 'https://placehold.co/150x150/D1FAE5/34D399?text=Broccoli', category: 'Vegetables', weight: '1 pc' },
            { id: 16, name: 'Grapes', price: 100, originalPrice: 120, image: 'https://placehold.co/150x150/E0F2FE/A5B4FC?text=Grapes', category: 'Fruits', weight: '500 gm', offerTag: 'Diwali' },
            { id: 17, name: 'Fish', price: 300, originalPrice: 350, image: 'https://placehold.co/150x150/DBEAFE/93C5FD?text=Fish', category: 'Meat', weight: '1 kg' },
            { id: 18, name: 'Juice', price: 95, originalPrice: 115, image: 'https://placehold.co/150x150/FFF7ED/F97316?text=Juice', category: 'Drinks', weight: '1 Ltr', offerTag: 'Holi' },
        ];
        
        // --- RENDER FUNCTIONS ---
        function renderHomePage() {
            pageContainers.home.innerHTML = `
                <div class="bg-yellow-300 rounded-lg p-6 mb-6 relative overflow-hidden">
                    <div class="z-10 relative"><h2 class="text-3xl font-extrabold text-gray-800">50%</h2><p class="text-lg font-semibold text-gray-700">CASHBACK</p><p class="text-sm text-gray-600 mb-4">ON GROCERIES</p><button class="bg-gray-800 text-white font-bold py-2 px-4 rounded-lg text-sm">Try it out now</button></div>
                    <img src="https://placehold.co/150x100/FFC107/FFFFFF?text=Fruits" alt="[Berries ki tasveer]" class="absolute -right-8 -bottom-5 w-32 h-auto opacity-80">
                </div>
                <div class="mb-8"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold text-gray-800">Shop by Category</h3></div><div id="category-preview-grid" class="grid grid-cols-4 gap-4 text-center"></div></div>
                <div class="mb-8"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold text-gray-800">Special Offer</h3><a href="#" class="text-sm font-medium text-blue-600">View All</a></div><div id="special-offers-grid" class="grid grid-cols-2 gap-4"></div></div>
                <div class="mb-8"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold text-gray-800">All Products</h3></div><div id="all-products-preview-grid" class="grid grid-cols-2 gap-4"></div></div>
                <div><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold text-gray-800">More Offers</h3></div><div id="seasonal-offers-grid" class="space-y-4"></div></div>
            `;
            renderCategoryPreview();
            renderSpecialOffers();
            renderAllProductsPreview();
            renderSeasonalOffers();
        }

        function createProductCard(product) {
            const cartItem = cart.find(item => item.id === product.id);
            const quantity = cartItem ? cartItem.quantity : 0;
            const discount = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);

            let buttonHtml;
            if (quantity > 0) {
                buttonHtml = `<div class="flex items-center justify-center bg-blue-500 text-white rounded-lg h-8 w-24"><button onclick="updateQuantity(${product.id}, -1)" class="px-3 font-bold">-</button><span class="px-2 text-sm">${quantity}</span><button onclick="updateQuantity(${product.id}, 1)" class="px-3 font-bold">+</button></div>`;
            } else {
                buttonHtml = `<button onclick="addToCart(${product.id})" class="bg-blue-500 text-white font-bold py-1 px-6 rounded-lg h-8">ADD</button>`;
            }

            return `
                <div class="bg-white border rounded-t-lg flex flex-col justify-between shadow-sm overflow-hidden" data-product-id="${product.id}">
                    <div class="relative">
                        <img src="${product.image}" alt="[${product.name} ki tasveer]" class="w-full h-32 object-cover rounded-t-lg">
                        ${discount > 0 ? `<div class="absolute top-0 left-0 bg-red-500 text-white text-xs font-bold py-1 px-2 rounded-tl-lg">${discount}% OFF</div>` : ''}
                    </div>
                    <div class="p-3 text-left flex-grow flex flex-col justify-between">
                        <div>
                            <p class="text-sm font-semibold text-gray-800 truncate">${product.name}</p>
                            <p class="text-xs text-gray-500 mt-1">${product.weight}</p>
                        </div>
                        <div class="flex justify-between items-center mt-2">
                            <div>
                                <span class="text-lg font-bold text-blue-600">₹${product.price}</span>
                                <span class="text-sm text-gray-500 line-through ml-1">₹${product.originalPrice}</span>
                            </div>
                            ${buttonHtml}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCategoryPreview() {
            const grid = document.getElementById('category-preview-grid');
            grid.innerHTML = categoriesData.slice(0, 7).map(cat => `<button onclick="showCategory('${cat.name}')" class="category-item"> <div class="${cat.bgColor} rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-2"><img src="${cat.image}" alt="[${cat.name} ki tasveer]" class="w-10 h-10 rounded-full object-cover"></div> <span class="text-xs font-medium text-gray-700">${cat.name}</span></button>`).join('');
            grid.innerHTML += `<button onclick="showTab('categories')" class="category-item"><div class="bg-gray-200 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-2"><i class="fa-solid fa-border-all text-2xl text-gray-600"></i></div><span class="text-xs font-medium text-gray-700">View All</span></button>`;
        }

        function renderAllCategoriesPage() {
            const categoriesHtml = categoriesData.map(cat => `<button onclick="showCategory('${cat.name}')" class="category-item"> <div class="${cat.bgColor} rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-2"><img src="${cat.image}" alt="[${cat.name} ki tasveer]" class="w-10 h-10 rounded-full object-cover"></div> <span class="text-xs font-medium text-gray-700">${cat.name}</span></button>`).join('');
            pageContainers.categories.innerHTML = `<h2 class="text-xl font-bold text-gray-800 mb-4">All Categories</h2><div class="grid grid-cols-4 gap-4 text-center">${categoriesHtml}</div>`;
        }

        function renderSpecialOffers() {
            document.getElementById('special-offers-grid').innerHTML = allProductsData.slice(0, 6).map(createProductCard).join('');
        }

        function renderAllProductsPreview() {
            const grid = document.getElementById('all-products-preview-grid');
            grid.innerHTML = allProductsData.slice(6, 17).map(createProductCard).join('');
            grid.innerHTML += `<button onclick="showPage('allProducts')" class="border rounded-t-lg p-2 flex flex-col justify-center items-center shadow-sm bg-gray-50 hover:bg-gray-100"><i class="fa-solid fa-arrow-right text-3xl text-blue-600"></i><span class="text-sm font-bold text-blue-600 mt-2">View More</span></button>`;
        }

        function renderSeasonalOffers() {
            document.getElementById('seasonal-offers-grid').innerHTML = seasonalOffersData.map(offer => `
                <button onclick="showOffer('${offer.name}')" class="w-full h-24 rounded-lg bg-cover bg-center flex items-center justify-center text-white font-bold text-2xl shadow-lg" style="background-image: url('${offer.image}')">
                    ${offer.name}
                </button>
            `).join('');
        }
        
        function renderAllProductsPage() {
            const productsHtml = allProductsData.map(createProductCard).join('');
            pageContainers.allProducts.innerHTML = `<div class="flex items-center mb-4"><button onclick="showTab('home')" class="text-xl text-gray-700 mr-4"><i class="fa-solid fa-arrow-left"></i></button><h2 class="text-xl font-bold text-gray-800">All Products</h2></div><div class="grid grid-cols-2 gap-4">${productsHtml}</div>`;
        }

        function renderCategoryPage(categoryName) {
            const categoryProducts = allProductsData.filter(p => p.category === categoryName);
            const productsHtml = categoryProducts.length > 0 ? categoryProducts.map(createProductCard).join('') : `<p class="col-span-2 text-center text-gray-500">Is category mein koi product nahi hai.</p>`;
            pageContainers.category.innerHTML = `<div class="flex items-center mb-4"><button onclick="showTab('home')" class="text-xl text-gray-700 mr-4"><i class="fa-solid fa-arrow-left"></i></button><h2 class="text-xl font-bold text-gray-800">${categoryName}</h2></div><div class="grid grid-cols-2 gap-4">${productsHtml}</div>`;
        }

        function renderOfferPage(offerName) {
            const offerProducts = allProductsData.filter(p => p.offerTag === offerName.split(' ')[0]);
            const productsHtml = offerProducts.length > 0 ? offerProducts.map(createProductCard).join('') : `<p class="col-span-2 text-center text-gray-500">Is offer mein koi product nahi hai.</p>`;
            pageContainers.offer.innerHTML = `<div class="flex items-center mb-4"><button onclick="showTab('home')" class="text-xl text-gray-700 mr-4"><i class="fa-solid fa-arrow-left"></i></button><h2 class="text-xl font-bold text-gray-800">${offerName}</h2></div><div class="grid grid-cols-2 gap-4">${productsHtml}</div>`;
        }

        function renderCart() {
            if (cart.length === 0) {
                pageContainers.cart.innerHTML = `<div class="text-center mt-20"><i class="fa-solid fa-cart-arrow-down text-5xl text-gray-300"></i><h2 class="text-2xl font-bold text-gray-700 mt-4">Your Cart is Empty</h2><p class="text-gray-500">Looks like you haven't added anything to your cart yet.</p></div>`;
            } else {
                let itemsHtml = '';
                let subtotal = 0;
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    subtotal += itemTotal;
                    itemsHtml += `<div class="flex items-center justify-between bg-white p-3 rounded-lg shadow-sm mb-3"><img src="${item.image}" alt="[${item.name} ki tasveer]" class="w-16 h-16 rounded-md"><div class="flex-grow mx-3"><p class="font-bold text-gray-800">${item.name}</p><p class="text-sm text-gray-600">₹${item.price} x ${item.quantity} = <span class="font-semibold">₹${itemTotal}</span></p></div><div class="flex items-center justify-center bg-red-500 text-white rounded-full h-8"><button onclick="updateQuantity(${item.id}, -1)" class="px-3">-</button><span class="px-2 text-sm">${item.quantity}</span><button onclick="updateQuantity(${item.id}, 1)" class="px-3">+</button></div></div>`;
                });
                const deliveryFee = 30;
                const total = subtotal + deliveryFee;
                pageContainers.cart.innerHTML = `<h2 class="text-xl font-bold text-gray-800 mb-4">My Cart</h2><div id="cart-items-container">${itemsHtml}</div><div class="mt-6 bg-gray-50 p-4 rounded-lg"><h3 class="text-lg font-bold text-gray-800 mb-3">Order Summary</h3><div class="space-y-2"><div class="flex justify-between text-gray-600"><span>Subtotal</span><span>₹${subtotal.toFixed(2)}</span></div><div class="flex justify-between text-gray-600"><span>Delivery Fee</span><span>₹${deliveryFee.toFixed(2)}</span></div><hr class="my-2"><div class="flex justify-between font-bold text-lg text-gray-800"><span>To Pay</span><span>₹${total.toFixed(2)}</span></div></div><button onclick="handleCheckout()" class="w-full bg-red-500 text-white font-bold py-3 rounded-lg mt-4 hover:bg-red-600">Proceed to Checkout</button></div>`;
            }
            renderCartBadge();
        }

        function renderCheckoutPage() {
            pageContainers.checkout.innerHTML = `<div class="flex items-center mb-4"><button onclick="showTab('cart')" class="text-xl text-gray-700 mr-4"><i class="fa-solid fa-arrow-left"></i></button><h2 class="text-xl font-bold text-gray-800">Delivery Address</h2></div><form id="address-form" onsubmit="placeOrder(event)"><div class="space-y-4"><input type="text" name="fullName" placeholder="Full Name" class="w-full p-3 border rounded-lg" value="${currentUser && currentUser.address ? currentUser.address.fullName : ''}" required><input type="tel" name="mobile" placeholder="Mobile Number" class="w-full p-3 border rounded-lg" value="${currentUser && currentUser.mobile ? currentUser.mobile : ''}" required><input type="text" name="houseNo" placeholder="House No, Building Name" class="w-full p-3 border rounded-lg" value="${currentUser && currentUser.address ? currentUser.address.houseNo : ''}" required><input type="text" name="street" placeholder="Street, Area" class="w-full p-3 border rounded-lg" value="${currentUser && currentUser.address ? currentUser.address.street : ''}" required><input type="text" name="city" placeholder="City" class="w-full p-3 border rounded-lg" value="${currentUser && currentUser.address ? currentUser.address.city : ''}" required><input type="text" name="pincode" placeholder="Pincode" class="w-full p-3 border rounded-lg" value="${currentUser && currentUser.address ? currentUser.address.pincode : ''}" required></div><div class="mt-6"><h3 class="text-lg font-bold text-gray-800 mb-3">Payment Option</h3><div class="border-2 border-blue-500 bg-blue-50 rounded-lg p-3 flex items-center"><i class="fa-solid fa-wallet text-blue-600 text-xl"></i><span class="font-semibold text-gray-800 ml-3">Cash on Delivery (COD)</span><i class="fa-solid fa-check-circle text-blue-600 ml-auto text-xl"></i></div></div><button type="submit" class="w-full bg-red-500 text-white font-bold py-3 rounded-lg mt-6 hover:bg-red-600">Place Order</button></form>`;
        }
        
        function renderConfirmationPage() {
            pageContainers.confirmation.innerHTML = `<div class="text-center mt-10"><i class="fa-solid fa-circle-check text-6xl text-green-500"></i><h2 class="text-2xl font-bold text-gray-800 mt-4">Your order is confirmed!</h2><div class="text-left bg-gray-50 p-4 rounded-lg mt-4"><p class="font-semibold text-gray-700">Delivery to:</p><p class="text-gray-600">${deliveryAddress.fullName}</p><p class="text-gray-600">${deliveryAddress.houseNo}, ${deliveryAddress.street}</p><p class="text-gray-600">${deliveryAddress.city}, ${deliveryAddress.pincode}</p><p class="text-gray-600">Mobile: ${deliveryAddress.mobile}</p></div><p class="text-gray-500 mt-4">Will be delivered in 24hr. Thank you!</p><button onclick="goHomeAndReset()" class="w-full bg-blue-500 text-white font-bold py-3 rounded-lg mt-6 hover:bg-blue-600">Back to Home</button></div>`;
        }

        function renderProfilePage() {
            if (isLoggedIn) {
                pageContainers.profile.innerHTML = `
                    <div class="profile-header h-40 relative">
                        <div class="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 text-center">
                            <div class="relative w-24 h-24 rounded-full border-4 border-white bg-gray-200 shadow-md">
                                <img src="https://placehold.co/96x96/EFEFEF/333333?text=${currentUser.name.charAt(0)}" class="w-full h-full rounded-full object-cover">
                                <button class="absolute bottom-0 right-0 bg-white w-8 h-8 rounded-full flex items-center justify-center shadow"><i class="fa-solid fa-camera text-gray-600"></i></button>
                            </div>
                        </div>
                    </div>
                    <div class="text-center mt-16 p-4">
                        <h2 class="text-2xl font-bold">${currentUser.name}</h2>
                        <p class="text-gray-500">ID: ${currentUser.id}</p>
                    </div>
                    <div class="mt-6 p-4 bg-white rounded-lg shadow-md flex justify-around mx-4">
                        <button onclick="showPage('orders')" class="text-center"><div class="text-2xl"><i class="fa-solid fa-box"></i></div><span class="text-sm">All Order</span></button>
                        <button class="text-center"><div class="text-2xl"><i class="fa-solid fa-gift"></i></div><span class="text-sm">Voucher</span></button>
                        <button class="text-center"><div class="text-2xl"><i class="fa-solid fa-map-marker-alt"></i></div><span class="text-sm">Address</span></button>
                    </div>
                    <div class="mt-4 bg-white rounded-lg shadow-md mx-4">
                        <ul class="divide-y">
                            <li class="p-4 flex justify-between items-center"><span><i class="fa-solid fa-user mr-3"></i>My profile</span><i class="fa-solid fa-chevron-right text-gray-400"></i></li>
                            <li class="p-4 flex justify-between items-center"><span><i class="fa-solid fa-bell mr-3"></i>Notification</span><i class="fa-solid fa-chevron-right text-gray-400"></i></li>
                            <li class="p-4 flex justify-between items-center"><span><i class="fa-solid fa-cog mr-3"></i>Setting</span><i class="fa-solid fa-chevron-right text-gray-400"></i></li>
                            <li class="p-4 flex justify-between items-center"><span><i class="fa-solid fa-credit-card mr-3"></i>Payment</span><i class="fa-solid fa-chevron-right text-gray-400"></i></li>
                            <li class="p-4 flex justify-between items-center cursor-pointer" onclick="logout()"><span><i class="fa-solid fa-right-from-bracket mr-3"></i>Log Out</span></li>
                        </ul>
                    </div>
                `;
            } else {
                pageContainers.profile.innerHTML = `<div class="text-center mt-20 p-4"><h2 class="text-2xl font-bold">Welcome to Primemart</h2><p class="text-gray-500 mt-2">Log in or sign up to continue</p><button onclick="showPage('loginMobile')" class="w-full bg-blue-500 text-white font-bold py-3 rounded-lg mt-6 hover:bg-blue-600">Login / Sign Up</button></div>`;
            }
        }

        function renderOrdersPage() {
            let content;
            if (currentUser && currentUser.orders.length > 0) {
                content = currentUser.orders.map(order => `
                    <div class="bg-white p-4 rounded-lg shadow-sm mb-4">
                        <div class="flex justify-between items-center mb-3 pb-3 border-b">
                            <div>
                                <span class="font-bold block">Order ID: ${order.id}</span>
                                <span class="text-sm text-gray-500">${order.date}</span>
                            </div>
                            <span class="font-bold text-lg">₹${order.total.toFixed(2)}</span>
                        </div>
                        <div class="space-y-3">
                            ${order.items.map(item => `
                                <div class="flex items-center">
                                    <img src="${item.image}" alt="[${item.name} ki tasveer]" class="w-16 h-16 rounded-md mr-4">
                                    <div class="flex-grow">
                                        <p class="font-semibold">${item.name}</p>
                                        <p class="text-sm text-gray-600">₹${item.price} x ${item.quantity}</p>
                                    </div>
                                    <p class="font-semibold">₹${(item.price * item.quantity).toFixed(2)}</p>
                                </div>
                            `).join('')}
                        </div>
                        <div class="text-right mt-4">
                            <button onclick="showInvoice('${order.id}')" class="bg-blue-500 text-white text-sm font-semibold py-2 px-4 rounded-lg hover:bg-blue-600">View Invoice</button>
                        </div>
                    </div>
                `).join('');
            } else {
                content = `<p class="text-center text-gray-500 mt-10">You have no past orders.</p>`;
            }
            pageContainers.orders.innerHTML = `<div class="flex items-center mb-4"><button onclick="showTab('profile')" class="text-xl text-gray-700 mr-4"><i class="fa-solid fa-arrow-left"></i></button><h2 class="text-xl font-bold text-gray-800">All Orders</h2></div><div>${content}</div>`;
        }

        function renderInvoicePage(orderId) {
            const order = currentUser.orders.find(o => o.id === orderId);
            if (!order) return;

            const subtotal = order.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryFee = order.total - subtotal;

            pageContainers.invoice.innerHTML = `
                <div class="bg-white rounded-lg shadow-lg">
                    <div class="p-4 no-print">
                        <button onclick="showPage('orders')" class="text-xl text-gray-700 mr-4"><i class="fa-solid fa-arrow-left"></i> Back to Orders</button>
                    </div>
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <div>
                                <h1 class="text-3xl font-bold text-blue-600">primemart</h1>
                                <p class="text-gray-500">Grocery Invoice</p>
                            </div>
                            <div class="text-right">
                                <p class="font-bold">Invoice #${order.id}</p>
                                <p class="text-gray-600">Date: ${order.date}</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-600 font-semibold mb-2">Billed To:</p>
                        <p class="font-bold">${order.address.fullName}</p>
                        <p>${order.address.houseNo}, ${order.address.street}</p>
                        <p>${order.address.city}, ${order.address.pincode}</p>
                        <p>Mobile: ${order.address.mobile}</p>
                    </div>
                    <div class="px-6 pb-6">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-2">Item</th>
                                    <th class="p-2 text-center">Qty</th>
                                    <th class="p-2 text-right">Rate</th>
                                    <th class="p-2 text-right">Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${order.items.map(item => `
                                    <tr class="border-b">
                                        <td class="p-2">${item.name}</td>
                                        <td class="p-2 text-center">${item.quantity}</td>
                                        <td class="p-2 text-right">₹${item.price.toFixed(2)}</td>
                                        <td class="p-2 text-right">₹${(item.price * item.quantity).toFixed(2)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    <div class="p-6 bg-gray-50 rounded-b-lg">
                        <div class="flex justify-end">
                            <div class="w-full md:w-1/2">
                                <div class="flex justify-between text-gray-700"><p>Subtotal:</p><p>₹${subtotal.toFixed(2)}</p></div>
                                <div class="flex justify-between text-gray-700"><p>Delivery Fee:</p><p>₹${deliveryFee.toFixed(2)}</p></div>
                                <hr class="my-2">
                                <div class="flex justify-between font-bold text-xl"><p>Grand Total:</p><p>₹${order.total.toFixed(2)}</p></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-6 text-center no-print">
                    <button onclick="window.print()" class="bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600"><i class="fa-solid fa-download mr-2"></i>Download Invoice</button>
                </div>
            `;
        }

        // --- AUTH RENDER FUNCTIONS ---
        function renderLoginMobilePage() {
            pageContainers.loginMobile.innerHTML = `<div class="flex items-center mb-4"><button onclick="showTab('profile')" class="text-xl text-gray-700 mr-4"><i class="fa-solid fa-arrow-left"></i></button><h2 class="text-xl font-bold text-gray-800">Enter Mobile Number</h2></div><form onsubmit="handleMobileSubmit(event)"><input type="tel" name="mobile" placeholder="10-digit mobile number" class="w-full p-3 border rounded-lg" required pattern="[0-9]{10}"><button type="submit" class="w-full bg-red-500 text-white font-bold py-3 rounded-lg mt-6 hover:bg-red-600">Continue</button></form>`;
        }

        function renderLoginOtpPage() {
            pageContainers.loginOtp.innerHTML = `<div class="flex items-center mb-4"><button onclick="showPage('loginMobile')" class="text-xl text-gray-700 mr-4"><i class="fa-solid fa-arrow-left"></i></button><h2 class="text-xl font-bold text-gray-800">Enter OTP</h2></div><p class="text-center text-gray-500 mb-4">An OTP has been sent to ${tempMobile}.<br>(Hint: Use any 4 digits)</p><form onsubmit="handleOtpSubmit(event)"><input type="tel" name="otp" placeholder="----" class="w-full p-3 border rounded-lg text-center tracking-[1em]" required maxlength="4"><button type="submit" class="w-full bg-red-500 text-white font-bold py-3 rounded-lg mt-6 hover:bg-red-600">Verify OTP</button></form>`;
        }

        function renderLoginDetailsPage() {
            pageContainers.loginDetails.innerHTML = `<div class="flex items-center mb-4"><h2 class="text-xl font-bold text-gray-800">Tell Us Your Name</h2></div><form onsubmit="handleDetailsSubmit(event)"><div class="space-y-4"><input type="text" name="name" placeholder="Full Name" class="w-full p-3 border rounded-lg" required></div><button type="submit" class="w-full bg-red-500 text-white font-bold py-3 rounded-lg mt-6 hover:bg-red-600">Finish Setup</button></form>`;
        }

        // --- LOGIC & EVENT HANDLERS ---
        function addToCart(productId) {
            const product = allProductsData.find(p => p.id === productId);
            const cartItem = cart.find(item => item.id === productId);
            if (cartItem) cartItem.quantity++;
            else cart.push({ ...product, quantity: 1 });
            
            refreshProductCard(productId);
            renderCart();
        }

        function updateQuantity(productId, change) {
            const cartItem = cart.find(item => item.id === productId);
            if (cartItem) {
                cartItem.quantity += change;
                if (cartItem.quantity <= 0) cart = cart.filter(item => item.id !== productId);
            }
            refreshProductCard(productId);
            renderCart();
        }

        function refreshProductCard(productId) {
            const product = allProductsData.find(p => p.id === productId);
            if (!product) return;

            const newCardHtml = createProductCard(product);
            const cards = document.querySelectorAll(`[data-product-id="${productId}"]`);
            cards.forEach(card => card.outerHTML = newCardHtml);
        }
        
        function renderCartBadge() {
            const totalQuantity = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartBadge.innerText = totalQuantity;
            if (totalQuantity > 0) {
                cartBadge.classList.remove('hidden');
                cartBadge.classList.add('badge-pop');
                cartBadge.addEventListener('animationend', () => {
                    cartBadge.classList.remove('badge-pop');
                }, { once: true });
            } else {
                cartBadge.classList.add('hidden');
            }
        }

        function showPage(pageKey) {
            Object.values(pageContainers).forEach(c => c.classList.remove('active'));
            pageContainers[pageKey].classList.add('active');
            
            const fullScreenPages = ['checkout', 'confirmation', 'loginMobile', 'loginOtp', 'loginDetails', 'orders', 'invoice', 'offer'];
            const isFullScreen = fullScreenPages.includes(pageKey);
            mainHeader.style.display = isFullScreen ? 'none' : 'block';
            bottomNav.style.display = 'flex'; // Always visible
            
            const renderMap = {
                home: renderHomePage,
                categories: renderAllCategoriesPage,
                cart: renderCart,
                profile: renderProfilePage,
                allProducts: renderAllProductsPage,
                checkout: renderCheckoutPage,
                confirmation: renderConfirmationPage,
                orders: renderOrdersPage,
                loginMobile: renderLoginMobilePage,
                loginOtp: renderLoginOtpPage,
                loginDetails: renderLoginDetailsPage,
            };
            if (renderMap[pageKey]) renderMap[pageKey]();
        }

        function showTab(tabKey) {
            showPage(tabKey);
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('tab-active'));
            const button = document.querySelector(`button[onclick="showTab('${tabKey}')"]`);
            if (button) button.classList.add('tab-active');
        }

        function showCategory(categoryName) {
            showPage('category');
            renderCategoryPage(categoryName);
        }

        function showOffer(offerName) {
            showPage('offer');
            renderOfferPage(offerName);
        }

        function showInvoice(orderId) {
            showPage('invoice');
            renderInvoicePage(orderId);
        }

        function handleCheckout() {
            if (isLoggedIn) {
                showPage('checkout');
            } else {
                checkoutRedirect = true;
                showTab('profile');
            }
        }
        
        function placeOrder(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            deliveryAddress = Object.fromEntries(formData.entries());
            if (isLoggedIn) {
                currentUser.address = deliveryAddress;
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const newOrder = {
                    id: Date.now().toString().slice(-6),
                    date: new Date().toLocaleDateString('en-GB'),
                    items: [...cart],
                    total: subtotal + 30,
                    address: { ...deliveryAddress }
                };
                currentUser.orders.push(newOrder);
                cart = []; // Clear the cart immediately
                renderCartBadge(); // Update the badge UI immediately
                showPage('confirmation');
            }
        }
        
        function goHomeAndReset() {
            deliveryAddress = {};
            showTab('home');
        }

        // --- AUTH LOGIC ---
        function handleMobileSubmit(event) {
            event.preventDefault();
            tempMobile = event.target.elements.mobile.value;
            showPage('loginOtp');
        }

        function handleOtpSubmit(event) {
            event.preventDefault();
            showPage('loginDetails');
        }

        function handleDetailsSubmit(event) {
            event.preventDefault();
            const name = event.target.elements.name.value;
            currentUser = {
                id: Date.now().toString().slice(-7),
                name: name,
                mobile: tempMobile,
                address: null,
                orders: []
            };
            isLoggedIn = true;
            
            if (checkoutRedirect) {
                checkoutRedirect = false;
                showPage('checkout');
            } else {
                showTab('profile');
            }
        }

        function logout() {
            isLoggedIn = false;
            currentUser = null;
            showTab('profile');
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            showTab('home');
        });
    </script>

</body>
</html>
